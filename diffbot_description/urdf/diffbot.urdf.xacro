<?xml version="1.0"?>
<robot name="diffbot" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- ========== Links (최소 예시) ========== -->
  <link name="base_link"/>
  <link name="left_wheel_link"/>
  <link name="right_wheel_link"/>

  <!-- ========== Joints (중요: joint 이름이 ros2_control과 일치해야 함) ========== -->
  <joint name="left_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="left_wheel_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
  </joint>

  <joint name="right_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="right_wheel_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
  </joint>

  <!-- =========================================================
       ros2_control: hardware plugin 연결 핵심 블록
       ========================================================= -->
  <ros2_control name="OpenCRDiffBot" type="system">
    <hardware>
      <plugin>opencr_diffbot_hw/OpenCRSystem</plugin>

      <!-- OpenCR 쪽 시리얼 포트/속도: Step 4~5에서 info_.hardware_parameters로 읽음 -->
      <param name="device">/dev/ttyACM0</param>
      <param name="baud">115200</param>
    </hardware>

    <!-- 조인트 2개: 이 이름이 OpenCRSystem::on_init()에서 읽는 info_.joints[0], [1]로 들어옴 -->
    <joint name="left_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <joint name="right_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>
  </ros2_control>

</robot>
