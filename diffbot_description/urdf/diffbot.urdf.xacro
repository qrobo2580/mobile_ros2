<?xml version="1.0"?>
<robot name="diffbot" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- ========== Links (최소 예시) ========== -->
  <link name="base_link"/>
  <link name="left_wheel_link"/>
  <link name="right_wheel_link"/>
  <link name="imu_link"/>



  <joint name="imu_joint" type="fixed">
    <parent link="base_link"/>
    <child link="imu_link"/>
    <!-- IMU가 base_link 기준 어디에 붙었는지. 모르면 일단 0 -->
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>



  <!-- ========== Joints (중요: joint 이름이 ros2_control과 일치해야 함) ========== -->
  <joint name="left_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="left_wheel_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
  </joint>

  <joint name="right_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="right_wheel_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
  </joint>

  <!-- =========================================================
       ros2_control: hardware plugin 연결 핵심 블록
       ========================================================= -->
  <ros2_control name="OpenCRDiffBot" type="system">
    <hardware>
      <plugin>opencr_diffbot_hw/OpenCRSystem</plugin>

      <!-- OpenCR serial parameters -->
      <param name="device">/dev/ttyACM0</param>
      <param name="baud">115200</param>
    </hardware>

    <!-- ========================= -->
    <!-- Actuated joints (wheels)  -->
    <!-- ========================= -->
    <joint name="left_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <joint name="right_wheel_joint">
      <command_interface name="velocity"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <!-- ========================= -->
    <!-- IMU sensor declaration   -->
    <!-- ========================= -->
    <sensor name="imu">
      <!-- Orientation (quaternion) -->
      <state_interface name="orientation.x"/>
      <state_interface name="orientation.y"/>
      <state_interface name="orientation.z"/>
      <state_interface name="orientation.w"/>

      <!-- Angular velocity (rad/s) -->
      <state_interface name="angular_velocity.x"/>
      <state_interface name="angular_velocity.y"/>
      <state_interface name="angular_velocity.z"/>

      <!-- Linear acceleration (m/s^2) -->
      <state_interface name="linear_acceleration.x"/>
      <state_interface name="linear_acceleration.y"/>
      <state_interface name="linear_acceleration.z"/>
    </sensor>

  </ros2_control>


</robot>
